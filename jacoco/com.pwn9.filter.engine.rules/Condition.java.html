<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Condition.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">PwnFilter</a> &gt; <a href="index.source.html" class="el_package">com.pwn9.filter.engine.rules</a> &gt; <span class="el_source">Condition.java</span></div><h1>Condition.java</h1><pre class="source lang-java linenums">/*
 *  PwnFilter - Chat and user-input filter with the power of Regex
 *  Copyright (C) 2016 Pwn9.com / Sage905 &lt;sage905@takeflight.ca&gt;
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 *
 *
 */

package com.pwn9.filter.engine.rules;

import com.pwn9.filter.engine.api.FilterContext;


/**
 * &lt;p&gt;Condition class.&lt;/p&gt;
 *
 * @author Sage905
 * @version $Id: $Id
 */
public class Condition {


    final CondType type;
    final CondFlag flag;
    final String parameters;
    /**
     * &lt;p&gt;Constructor for Condition.&lt;/p&gt;
     *
     * @param t a {@link com.pwn9.filter.engine.rules.Condition.CondType} object.
     * @param f a {@link com.pwn9.filter.engine.rules.Condition.CondFlag} object.
     * @param p a {@link java.lang.String} object.
     */
<span class="fc" id="L45">    private Condition(CondType t, CondFlag f, String p) {</span>
<span class="fc" id="L46">        type = t;</span>
<span class="fc" id="L47">        flag = f;</span>
<span class="fc" id="L48">        parameters = p;</span>
<span class="fc" id="L49">    }</span>

    /**
     * &lt;p&gt;newCondition.&lt;/p&gt;
     *
     * @param line a {@link java.lang.String} object.
     * @return a {@link com.pwn9.filter.engine.rules.Condition} object.
     */
    public static Condition newCondition(String line) {
<span class="fc" id="L58">        String[] parts = line.split(&quot;\\s&quot;, 2);</span>
<span class="fc" id="L59">        String conditionName = parts[0];</span>
        String conditionData;
<span class="pc bpc" id="L61" title="1 of 2 branches missed.">        conditionData = ((parts.length &gt; 1) ? parts[1] : &quot;&quot;);</span>

<span class="fc" id="L63">        return newCondition(conditionName, conditionData);</span>
    }

    /**
     * &lt;p&gt;newCondition.&lt;/p&gt;
     *
     * @param command         a {@link java.lang.String} object.
     * @param parameterString a {@link java.lang.String} object.
     * @return a {@link com.pwn9.filter.engine.rules.Condition} object.
     */
    public static Condition newCondition(String command, String parameterString) {
        String subCmd;
        CondType newType;
        CondFlag newFlag;
        String newParameters;

        try {
<span class="fc" id="L80">            newFlag = CondFlag.valueOf(command);</span>
<span class="nc" id="L81">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L82">            return null;</span>
<span class="fc" id="L83">        }</span>

<span class="fc" id="L85">        String[] parts = parameterString.split(&quot;\\s&quot;, 2);</span>
<span class="fc" id="L86">        subCmd = parts[0].toLowerCase();</span>
        try {
<span class="fc" id="L88">            newType = Condition.CondType.valueOf(subCmd);</span>
<span class="nc" id="L89">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L90">            return null;</span>
<span class="fc" id="L91">        }</span>
<span class="pc bpc" id="L92" title="1 of 2 branches missed.">        if (parts.length &gt; 1) {</span>
<span class="fc" id="L93">            newParameters = parts[1];</span>
        } else {
<span class="nc" id="L95">            newParameters = &quot;&quot;;</span>
        }

<span class="fc" id="L98">        return new Condition(newType, newFlag, newParameters);</span>
    }

    /**
     * &lt;p&gt;isCondition.&lt;/p&gt;
     *
     * @param command a {@link java.lang.String} object.
     * @return a boolean.
     */
    public static boolean isCondition(String command) {
        try {
<span class="pc bpc" id="L109" title="1 of 2 branches missed.">            return CondFlag.valueOf(command) != CondFlag.NONE;</span>
<span class="fc" id="L110">        } catch (IllegalArgumentException e) {</span>
<span class="fc" id="L111">            return false;</span>
        }
    }

    /**
     * Checks a message against this condition.  This method returns true if
     * the condition is met, false otherwise.  Processing of the current rule
     * will be aborted if _any_ check returns false.
     *
     * @param state The MessageState
     * @return true if this condition is met, false otherwise
     */
    public boolean check(FilterContext state) {
<span class="fc" id="L124">        boolean matched = false;</span>
<span class="pc bpc" id="L125" title="3 of 5 branches missed.">        switch (type) {</span>
            case user:
<span class="nc bnc" id="L127" title="All 2 branches missed.">                for (String check : parameters.split(&quot;\\s&quot;)) {</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">                    if (state.getAuthor().getName().equalsIgnoreCase(check))</span>
<span class="nc" id="L129">                        matched = true;</span>
                }
            case permission:
<span class="nc bnc" id="L132" title="All 2 branches missed.">                for (String check : parameters.split(&quot;\\s&quot;)) {</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">                    if (state.getAuthor().hasPermission(check)) matched = true;</span>
                }
            case string:
<span class="fc bfc" id="L136" title="All 2 branches covered.">                for (String check : parameters.split(&quot;\\|&quot;)) {</span>
<span class="fc bfc" id="L137" title="All 2 branches covered.">                    if (state.getOriginalMessage().toString().toUpperCase().contains(check.toUpperCase()))</span>
<span class="fc" id="L138">                        matched = true;</span>
                }
            case command:
<span class="fc bfc" id="L141" title="All 2 branches covered.">                for (String check : parameters.split(&quot;\\|&quot;)) {</span>
<span class="fc bfc" id="L142" title="All 2 branches covered.">                    if (state.getFilterClient().getShortName().equals(&quot;COMMAND&quot;)) {</span>
<span class="fc" id="L143">                        String command = state.getOriginalMessage().toString().split(&quot;\\s&quot;)[0].replaceFirst(&quot;^\\/&quot;, &quot;&quot;);</span>
<span class="fc bfc" id="L144" title="All 2 branches covered.">                        if (command.toUpperCase().matches(check.toUpperCase()))</span>
<span class="fc" id="L145">                            matched = true;</span>
                    }
                }

        }
<span class="pc bpc" id="L150" title="2 of 3 branches missed.">        switch (flag) {</span>
            case ignore:
<span class="fc bfc" id="L152" title="All 2 branches covered.">                return !matched;</span>
            case require:
<span class="nc" id="L154">                return matched;</span>
        }
        // Well, we shouldn't be able to get here, but in case we did, return false
<span class="nc" id="L157">        return false;</span>
    }

<span class="fc" id="L160">    enum CondFlag {</span>
<span class="fc" id="L161">        NONE, ignore, require</span>
    }

<span class="fc" id="L164">    enum CondType {</span>
<span class="fc" id="L165">        permission, user, string, command,</span>
    }

}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>